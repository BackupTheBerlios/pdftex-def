% \iffalse
%<package>\ProvidesFile{pdftex.def}
%<package>         [2004/09/07 v0.10a-BETA graphics/color for pdftex]
%<package003>\ProvidesFile{pdftex003.def}
%<package003>         [2002/06/19 v0.03k graphics/color for pdftex]
%
%<*driver>
\ProvidesFile{pdftex.drv}
      [2003/07/14 v1.00 Driver for pdftex Package (MS/HO)]
\documentclass{ltxdoc}
\usepackage[T1]{fontenc}
\usepackage{ifpdf}
\ifpdf
  \usepackage[pdftex]{graphicx}
\fi
% \GetFileInfo fills \filedate and \fileversion, but for this the file
% has to be loaded into TeX. This is of course only possible with
% pdftex. :-(
\GetFileInfo{pdftex.def}
\usepackage{xspace}
\usepackage{rcs}
\EnableCrossrefs
\RecordChanges    % Gather update information
%%\DisableCrossrefs% Say \DisableCrossrefs if index is ready
\CodelineIndex    % Index code by line number
\OnlyDescription  % comment out for implementation details
%%\OldMakeIndex   % use if your MakeIndex is pre-v2.9
\setcounter{IndexColumns}{2}
\setlength{\IndexMin}{40ex}
\setlength{\columnseprule}{.4pt}
\addtolength{\oddsidemargin}{1cm}
\addtolength{\textwidth}{-1cm}
\setcounter{StandardModuleDepth}{1}
\begin{document}
   \DocInput{pdftex.dtx}
   \PrintIndex\PrintChanges
   %  Make sure that the index is not printed twice
   %  (ltxdoc.cfg might have a second \PrintIndex command)
   \let\PrintChanges\relax
   \let\PrintIndex\relax
\end{document}
%</driver>
%
% Copyright 2000-2004 David Carlisle, Sebastian Rahtz, Hans Hagen,
% Heiko Oberdiek and Martin Schröder
%
% This program may be redistributed and/or modified under the terms
% of the LaTeX Project Public License, either version 1.2 of this
% license, or (at your option) any later version.
% The latest version of this license is in
%   CTAN:macros/latex/base/lppl.txt.
%
% For error reports in case of UNCHANGED versions see pdftex.ins
%
% \fi
%
% \CheckSum{1838}
%% \RCS$Id: pdftex.dtx,v 1.5 2004/09/07 13:38:53 oneiros Exp $
% \RCS$Revision: 1.5 $
% \RCS$Date: 2004/09/07 13:38:53 $
%
%% \CharacterTable
%% {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%%  Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%%  Digits        \0\1\2\3\4\5\6\7\8\9
%%  Exclamation   \!     Double quote  \"     Hash (number) \#
%%  Dollar        \$     Percent       \%     Ampersand     \&
%%  Acute accent  \'     Left paren    \(     Right paren   \)
%%  Asterisk      \*     Plus          \+     Comma         \,
%%  Minus         \-     Point         \.     Solidus       \/
%%  Colon         \:     Semicolon     \;     Less than     \<
%%  Equals        \=     Greater than  \>     Question mark \?
%%  Commercial at \@     Left bracket  \[     Backslash     \\
%%  Right bracket \]     Circumflex    \^     Underscore    \_
%%  Grave accent  \`     Left brace    \{     Vertical bar  \|
%%  Right brace   \}     Tilde         \~}
%%
%
%  \pagestyle{headings}
%
%  \newcommand*{\file}[1]     {\texttt{#1}\xspace}
%  \newcommand{\plain}        {\texttt{plain}}
%  \newcommand{\bs}           {\texttt{\symbol{'134}}}
%  \newcommand*{\env}[1]      {\textsf{#1}}
%  \newcommand*{\option}[1]   {\textsf{#1}}
%  \newcommand*{\package}[1]  {\textsf{#1}\xspace}
%  \newcommand*{\dstag}[1]    {\emph{#1}\xspace}
%  \newcommand*{\NEWfeature}[1]{%
%     \hskip 1sp \marginpar{\small\sffamily\raggedright
%     New feature\\#1}}
%  \newcommand*{\NEWdescription}[1]{%
%     \hskip 1sp \marginpar{\small\sffamily\raggedright
%     New description\\#1}}
%  \newcommand*{\pdef}{\package{pdftex.def}}
%  \newcommand*{\ptex}{pdf\TeX\xspace}
%
%  \changes{v0.10a}{2003/07/14}{Started move to dtx (MS)}
%  \changes{v0.10a}{2004/09/07}{Added more documentation (MS)}
%
% ^^A -----------------------------
%
%  \title{\unskip
%     The \textsf{pdftex}-driver for \LaTeX^^A
%     \thanks{^^A
%        \ifpdf
%           The version number of this file is \fileversion,
%           last revised \filedate.
%        \else
%           The CVS-version number of this file is \RCSRevision,
%           last revised \RCSDate.
%        \fi
%        }^^A
%     }
%  \author{David Carlisle \and Sebastian Rahtz 
%          \and Hans Hagen \and Heiko Oberdiek
%          \and Martin Schröder^^A
%             \thanks{pdftex-latex@pdftex.org}^^A
%          }
%  \date{Documentation last changed \ifpdf\filedate\else\RCSDate\fi,\\
%        typeset \today}
%  \maketitle
%
% ^^A -----------------------------
%
%  \begin{abstract}
%     \pdef is the driver for \ptex for the graphics-Bundle of \LaTeX.
%  \end{abstract}
%
%
% ^^A -----------------------------
%
%  \tableofcontents
%
% ^^A -----------------------------
%
%  \section{Introduction}
%  ^^A
% This file is the driver for \ptex for the graphics-Bundle of \LaTeX
% (\package{graphics}, \package{graphicx}, \package{color}). It is
% also usable with \file{plain.tex} with the help of
% \file{miniltx.tex}.
%
% ^^A -----------------------------
%
%  \section{Usage}
%  ^^A
% Simply give the option \option{pdftex} in the \cs{usepackage}
% command of all supported packages (e.\,g. \package{graphics},
% \package{graphicx}, \package{color}).
%
% ^^A -----------------------------
%
% \subsection{Graphics inclusion}
% ^^A
% Images included multiple times in the document are included only
% once by this code and reused to save space in the PDF.
%
% ^^A -----------------------------
%
% \subsubsection{File types}
% ^^A
% \pdef supports PNG files (extension \texttt{.png}), JPEG files
% (extension \texttt{.jpg}), MetaPost files (extension \texttt{.mps})
% and PDF files (extension \texttt{.pdf}).
% MetaPost inclusion depends on loading a Con\TeX{}t module by Hans Hagen;
% PDF inclusion also needs a Con\TeX{}t module with old \ptex ($<0.12n$).
%
% ^^A -----------------------------
%
% \subsubsection{Options}
% ^^A
% \pdef provides additional options to be used in the optional
% argument of \cs{includegraphics} with the \package{graphicx}
% package. These are:
% \begin{description}
%   \item[\normalfont\option{alternate}]
%     TODO
%   \item[\normalfont\option{attr}]
%     A string which is directly placed in the dictionary of the
%     generated Forms XObject.
%   \item[\normalfont\option{page}]
%     The physical page number of the page to include of the PDF file.
%     Only valid for PDF files. Defaults to 1.
%   \item[\normalfont\option{quiet}]
%     TODO
%   \item[\normalfont\option{pagebox}]
%     A string specifying the boundary of to use for the included PDF
%     page: \textsf{mediabox} for the MediaBox, \textsf{cropbox} for
%     the CropBox, \textsf{bleedbox} for the BleedBox,
%     \textsf{trimbox} for the TrimBox and \textsf{artbox} for the
%     ArtBox.
%     Default is the CropBox for compatibilty with older versions of
%     \ptex.
%   \item[\normalfont\option{resolution}]
%     TODO
% \end{description}
%
% ^^A -----------------------------
%
% \subsection{Color support}
% ^^A
% The following models may be used:
% \begin{description}
%   \item[cmyk]   supported directly.
%   \item[rgb]    supported directly.
%   \item[RGB]    converted to rgb by this file.
%   \item[hsb]    converted to rgb by this file.
%   \item[HSB]    converted to rgb by this file.
%   \item[gray]   supported directly.
%   \item[named]  converted to cmyk by this file.
% \end{description}
%
% ^^A -----------------------------
%
%  \StopEventually{}
%
%
% ^^A -----------------------------
%
%  \section{Acknowledgements}
%  ^^A
%  TODO
%
% ^^A -----------------------------
%
%  \section{The implementation}
% ^^A
% This file produces two target files: \file{pdftex.def} (docstrip-tag
% \dstag{package}) and \file{pdftex003.def} (docstrip-tag
% \dstag{package003}). \file{pdftex.def} is the main driver and
% contains code for newer versions of \ptex ($\ge1.00$). If it's used
% with an older version of \ptex, it loads \file{pdftex003.def}.
%
% \begin{oldcomments}
% load the old version of pdftex.def for older versions of pdftex.
% \end{oldcomments}
%    \begin{macrocode}
%<*package>
\let\GPT@next\relax
\def\GPT@olddriver{\input{pdftex003.def}\endinput}%
\ifx\pdftexversion\@undefined
  \let\GPT@next\GPT@olddriver
\else
  \ifnum\pdftexversion<100\relax
    \let\GPT@next\GPT@olddriver
  \fi
\fi
\GPT@next
%</package>
%    \end{macrocode}
%    \begin{macrocode}
%<*package003>
\ifx\pdftexversion\@undefined
  \def\driver@release{1}%
\else
  \ifnum\pdftexversion<12
    \def\driver@release{2}%
  \else
    \ifnum\pdftexversion<13
      \ifnum \expandafter `\pdftexrevision < `n
        \def\driver@release{3}%
      \else
        \def\driver@release{4}%
      \fi
    \else
      \ifnum\pdftexversion=13
        \def\driver@release{5}%
      \else
        \ifnum\pdftexversion=14
          \def\driver@release{6}%
        \else
          \def\driver@release{7}%
        \fi
      \fi
    \fi
  \fi
\fi
%</package003>
%    \end{macrocode}
% \begin{oldcomments}
% miniltx.tex does not define \PackageWarning
% \end{oldcomments}
%    \begin{macrocode}
%<*package,package003>
% or \PackageWarningNoLine.
\@ifundefined{PackageWarning}{%
  \def\PackageWarning#1#2{%
    \begingroup
      \newlinechar=10 %
      \def\MessageBreak{%
        ^^J(#1)\@spaces\@spaces\@spaces\@spaces
      }%
      \immediate\write16{^^JPackage #1 Warning: #2\on@line.^^J}%
    \endgroup
  }%
}{}
\@ifundefined{PackageWarningNoLine}{%
  \def\PackageWarningNoLine#1#2{%
    \PackageWarning{#1}{#2\@gobble}%
  }%
}{}
\@ifundefined{on@line}{%
  \def\on@line{ on input line \the\inputlineno}%
}{}
\@ifundefined{@spaces}{%
  \def\@spaces{\space\space\space\space}%
}{}
\def\GPT@warn{\PackageWarning{pdftex.def}}%
\ifx\Gin@log\@undefined
  \def\Gin@log{\message}
\fi
%</package,package003>
%    \end{macrocode}
% \begin{oldcomments}
% Colour Support.
% \end{oldcomments}
%    \begin{macrocode}
%<*package,package003>
\def\c@lor@arg#1{%
  \dimen@#1\p@
  \ifdim\dimen@<\z@\dimen@\maxdimen\fi
  \ifdim\dimen@>\p@
    \PackageError{color}{Argument `#1' not in range [0,1]}\@ehd
  \fi
}
%</package,package003>
%    \end{macrocode}
%    \begin{macrocode}
%<*package>
% \GPT@arg@test{<value>}{<upper range>}{<cmd for result>}
\def\GPT@arg@test#1#2#3{%
  \def#3{#1}%
  \dimen@#1\p@
  \ifdim\dimen@<\z@
    \PackageError{color}{Argument `#1' too small, %
                         not in range [0,\number#2]}\@ehd
    \def#3{0}%
  \fi
  \ifdim\dimen@>#2\p@
    \PackageError{color}{Argument `#1' too large, %
                         not in range [0,\number#2]}\@ehd
    \def#3{#2}%
  \fi
}
%</package>
%    \end{macrocode}
%    \begin{macrocode}
%<*package,package003>
\def\color@cmyk#1#2{\c@lor@@cmyk#2\@@#1}
\def\c@lor@@cmyk#1,#2,#3,#4\@@#5{%
  \c@lor@arg{#4}%
  \c@lor@arg{#1}%
  \c@lor@arg{#2}%
  \c@lor@arg{#3}%
  \edef#5{#1 #2 #3 #4 k #1 #2 #3 #4 K}%
}
\def\color@gray#1#2{%
  \c@lor@arg{#2}%
  \edef#1{#2 g #2 G}%
}
\def\color@rgb#1#2{\c@lor@@rgb#2\@@#1}
\def\c@lor@@rgb#1,#2,#3\@@#4{%
  \c@lor@arg{#1}%
  \c@lor@arg{#2}%
  \c@lor@arg{#3}%
  \edef#4{#1 #2 #3 rg #1 #2 #3 RG}%
}
\def\color@RGB#1#2{\c@lor@@RGB#2\@@#1}
\def\c@lor@@RGB#1,#2,#3\@@#4{%
  \c@lor@RGB@rgb{#1}\@tempa
  \c@lor@RGB@rgb{#2}\@tempb
  \c@lor@RGB@rgb{#3}\@tempc
  \c@lor@@rgb\@tempa,\@tempb,\@tempc\@@#4%
}
\def\c@lor@RGB@rgb#1#2{%
  \dimen@#1\p@
  \divide\dimen@\@cclv
  \edef#2{\strip@pt\dimen@}%
}
%</package,package003>
%    \end{macrocode}
% \begin{footnotesize}
% \begin{oldcomments}
% The "hsb" color model is not supported by PDF, so the values
% are converted into "rgb" values:
%
%   Input: h (hue), s (saturation), b (brightness)
%          (h, s, b) \in ([0,1], [0,1], [0,1])       % hsb model
%          (H, S, B) \in ([0,360], [0,255], [0,255]) % HSB model
%          (h, s, b) := (H/360, S/255, B/255)
%   Output: r (red), g (green), b (blue)
%
%   M := (1 - s) * b;
%   D := s * b;
%   H := 6 * h;
%   x := (int)floor(H);
%   if (x >= 6) {
%       x := 0;
%       H := 0;
%   }
%   switch(x) {
%     case 0:    /* r >= g >= b */
%       r := b;
%       b := M;
%       g := M + D * H;
%       break;
%     case 1:    /* g >= r >= b */
%       g := b;
%       b := M;
%       r := M + D * (2 - H);
%       break;
%     case 2:    /* g >= b >= r */
%       g := b;
%       r := M;
%       b := M + D * (H - 2);
%       break;
%     case 3:    /* b >= g >= r */
%       b := b;
%       r := M;
%       g := M + D * (4 - H);
%       break;
%     case 4:    /* b >= r >= g */
%       b := b;
%       g := M;
%       r := M + D * (H - 4);
%       break;
%     case 5:    /* r >= b >= g */
%       r := b;
%       g := M;
%       b := M + D * (6 - H);
%       break;
%   }
%
% References:
% * "Color Gamut Transform Pairs" by Alvy Ray Smith
%   http://alvyray.com/Papers/PapersCG.htm
%   ftp://ftp.alvyray.com/Acrobat/Color78.pdf
% * Ghostscript's gs_cspace.ps
%   Caution: the implementation of case 6 is buggy currently (8.10).
% * "efg's Color Reference Library -- Color Science / Color Theory"
%   http://homepages.borland.com/efg2lab/Library/Color/Science.htm
%   http://homepages.borland.com/efg2lab/Graphics/Colors/HSV.htm
% \end{oldcomments}
% \end{footnotesize}
%    \begin{macrocode}
%<*package>
\def\color@hsb#1#2{\c@lor@@hsb#2\@@#1\z@}
\def\color@Hsb#1#2{\c@lor@@hsb#2\@@#1\@ne}
\def\color@HSB#1#2{\c@lor@@hsb#2\@@#1\tw@}
\def\c@lor@@hsb#1,#2,#3\@@#4#5{%
  \ifcase#5%
    \GPT@arg@test{#1}\@ne\@tempa
    \GPT@arg@test{#2}\@ne\@tempb
    \GPT@arg@test{#3}\@ne\@tempc
  \or
    \GPT@arg@test{#1}{360}\@tempa
    \GPT@arg@test{#2}\@ne\@tempb
    \GPT@arg@test{#3}\@ne\@tempc
  \else
    \GPT@arg@test{#1}{360}\@tempa
    \GPT@arg@test{#2}\@cclv\@tempb
    \GPT@arg@test{#3}\@cclv\@tempc
  \fi
  \begingroup
    \dimendef\H=1 % "hue" * 6
    \dimendef\s=2 % "saturation"
    \dimendef\b=3 % used for both "brightness" and "blue"
    \dimendef\M=5 % (1 - "saturation") * "brightness"
    \dimendef\D=6 % "saturation" * "brightness"
    \dimendef\r=7 % "red"
    \dimendef\g=8 % "green"
    \H=\@tempa\p@
    \s=\@tempb\p@
    \b=\@tempc\p@
    \ifcase#5%
    \or
      \divide\H 360 %
    \else
      \divide\H 360 %
      \divide\s\@cclv
      \divide\b\@cclv
    \fi
    \H=6\H
    \edef\x{\expandafter\GPT@floor\the\H}%
    \ifnum\x<6 %
    \else
      \def\x{0}%
      \H=\z@
    \fi
    \D=\strip@pt\b\s
    \GPT@hsb@calc
    \edef\x{%
      \strip@pt\r\space
      \strip@pt\g\space
      \strip@pt\b\space
    }%
    \edef\x{%
      \endgroup
      \def\noexpand#4{\x rg \x RG}%
    }%
  \x
}
%    \end{macrocode}
%    \begin{macrocode}
\begingroup
  \def\x{\def\GPT@floor}
  \catcode`P=12 %
  \catcode`T=12 %
\lowercase{\expandafter\endgroup\x#1.#2PT{#1}}%
%    \end{macrocode}
%    \begin{macrocode}
\begingroup\expandafter\expandafter\expandafter\endgroup
\expandafter\ifx\csname dimexpr\endcsname\relax
  \def\GPT@hsb@calc{%
    \M=\p@
    \advance\M-\s
    \M=\strip@pt\b\M
    % first use \b (brightness), thus it is free for \b (blue)
    \ifcase\x\relax
      \r=\b
      \b=\M
      \g=\strip@pt\D\H
      \advance\g\M
    \or % 1
      \g=\b
      \b=\M
      \r=2\p@
      \advance\r-\H
      \r=\strip@pt\D\r
      \advance\r\M
    \or % 2
      \g=\b
      \r=\M
      \b=\H
      \advance\b-2\p@
      \b=\strip@pt\D\b
      \advance\b\M
    \or % 3
      % \b=\b
      \r=\M
      \g=4\p@
      \advance\g-\H
      \g=\strip@pt\D\g
      \advance\g\M
    \or % 4
      % \b=\b
      \g=\M
      \r=\H
      \advance\r-4\p@
      \r=\strip@pt\D\r
      \advance\r\M
    \or % 5
      \r=\b
      \g=\M
      \b=6\p@
      \advance\b-\H
      \b=\strip@pt\D\b
      \advance\b\M
    \fi
  }%
\else
  \def\GPT@hsb@calc{%
    \M=\strip@pt\b\dimexpr \p@ - \s \relax
    % first use \b (brightness), thus it is free for \b (blue)
    \ifcase\x\relax
      \r=\b
      \b=\M
      \g=\dimexpr \M + \strip@pt\D \H \relax
    \or % 1
      \g=\b
      \b=\M
      \r=\dimexpr \M + \strip@pt\D \dimexpr 2\p@ - \H \relax\relax
    \or % 2
      \g=\b
      \r=\M
      \b=\dimexpr \M + \strip@pt\D \dimexpr \H - 2\p@ \relax\relax
    \or % 3
      % \b=\b
      \r=\M
      \g=\dimexpr \M + \strip@pt\D \dimexpr 4\p@ - \H \relax\relax
    \or % 4
      % \b=\b
      \g=\M
      \r=\dimexpr \M + \strip@pt\D \dimexpr \H - 4\p@ \relax\relax
    \or % 5
      \r=\b
      \g=\M
      \b=\dimexpr \M + \strip@pt\D \dimexpr 6\p@ - \H \relax\relax
    \fi
  }%
\fi
%</package>
%    \end{macrocode}
%    \begin{macrocode}
%<*package,package003>
\def\color@named#1#2{\c@lor@@named#2,,\@@#1}
\def\c@lor@@named#1,#2,#3\@@#4{%
  \@ifundefined{col@#1}{%
    \PackageError{color}{Undefined color `#1'}\@ehd
  }{%
    \edef#4{\csname col@#1\endcsname}%
  }%
}
%    \end{macrocode}
%    \begin{macrocode}
\def\set@color{%
  \pdfliteral{\current@color}%
  \aftergroup\reset@color
}
\def\reset@color{\pdfliteral{\current@color}}
\def\define@color@named#1#2{%
  \expandafter\edef\csname col@#1\endcsname{#2}%
}
\def\current@color{0 g 0 G}
%    \end{macrocode}
%    \begin{macrocode}
% v0.02t: support for \pagecolor
\def\set@page@color{%
  \global\let\current@page@color\current@color
  \@ifundefined{GPTorg@shipout}{%
    \global\let\GPTorg@shipout\shipout
    \gdef\shipout{%
      \afterassignment\GPT@shipout
      \global\setbox\@cclv=%
    }%
    \gdef\GPT@shipout{%
      \ifvoid\@cclv\relax
         \aftergroup\GPT@@shipout
         \GPT@pageliteral
      \else
        \GPTorg@shipout\vbox{%
          \GPT@pageliteral
          \box\@cclv
        }%
      \fi
    }%
    \gdef\GPT@@shipout{%
      \GPTorg@shipout\box\@cclv\relax
    }%
    \gdef\GPT@pageliteral{%
      \pdfliteral direct{%
        q % gsave
        \current@page@color\space
        n % newpath
        0 0 \strip@pt\pdfpagewidth\space
        \strip@pt\pdfpageheight\space re % rectangle
        % there is no need to convert to bp
        f % fill
        Q% grestore
      }%
    }%
  }{}%
}
%    \end{macrocode}
%    \begin{macrocode}
% Need the `colorfix' modifications as no internal colour stack
% is maintained
\AtBeginDocument{%
  \let\@ldc@l@r\color
  \def\color{%
    \@ifundefined{if@inlabel}{}{%
      \csname if@inlabel\expandafter\endcsname
      \expandafter\leavevmode\csname fi\endcsname
    }%
    \@ldc@l@r
  }%
  \let\@lduseb@x\usebox
  \def\usebox#1{\@lduseb@x{#1}\set@color}%
}
%    \end{macrocode}
% \begin{oldcomments}
% Note the magic in front of the file name after \pdfimage, to
% prevent it fouling up with file names starting with "depth".
% \end{oldcomments}
%    \begin{macrocode}
\def\Gread@png#1{%
  \setbox\@tempboxa\hbox{\pdfimage\noexpand\noexpand\noexpand\@empty#1\relax}%
  \def\Gin@llx{0}\let\Gin@lly\Gin@llx
  \Gin@defaultbp\Gin@urx{\wd\@tempboxa}%
  \Gin@defaultbp\Gin@ury{\ht\@tempboxa}%
}
%    \end{macrocode}
% \begin{footnotesize}
% \begin{oldcomments}
% support for
% * multipage pdf images (pdfTeX v0.14+)
% * alternate print image (bitmaps only)
%   * driver version>=5 (0.14)
%   * printed image can be resused, but not the base image,
%     because it's dictionary contains the additional key /Alternates.
%   * not supported by Ghostscript or xpdf.
% * option quiet
% * option attr for additional entries in the dictionary of the
%     generated Forms XObject
% * option pagebox for specifying the <pdf box spec>
%     Default is the cropbox to be compatible with old versions of pdfTeX.
% \end{oldcomments}
% \end{footnotesize}
%    \begin{macrocode}
% \GPT@page: page number of pdf image or \@empty otherwise.
\let\GPT@page\@empty
% \GPT@print: file name for alternate image or \@empty otherwise.
\let\GPT@print\@empty
%</package,package003>
%<*package003>
\begingroup
  \toks@{%
    \ifnum\driver@release>5
      \define@key{Gin}{page}{%
        \def\GPT@page{#1}%
      }%
      \define@key{Gin}{print}{%
        \def\GPT@print{#1}%
      }%
    \else
      \define@key{Gin}{page}{%
        \GPT@warn{%
          pdfTeX >= 0.14 required for option\MessageBreak `page'%
        }%
      }%
      \define@key{Gin}{print}{%
        \GPT@warn{%
          pdfTeX >= 0.14 required for option\MessageBreak `print'%
        }%
      }%
    \fi
    \define@key{Gin}{quiet}[]{%
      \let\Gin@log\@gobble
    }%
    \define@key{Gin}{resolution}{%
      \pdfimageresolution#1\relax
    }%
  }%
  \@ifundefined{define@key}{%
    \edef\x{\endgroup
      \noexpand\AtBeginDocument{%
        \noexpand\@ifundefined{define@key}{}{\the\toks@}%
      }%
    }\x
  }{%
    \expandafter\endgroup\the\toks@
  }
%</package003>
%<*package>
% \GPT@attr: additional attributes.
\let\GPT@attr\@empty
% \GPT@pagebox: <pdf box spec>
\let\GPT@pagebox\@empty
%
% Test for \define@key without defining it
\begingroup\expandafter\expandafter\expandafter\endgroup
\expandafter\ifx\csname define@key\endcsname\relax
  % package keyval is not loaded yet, thus its definitions
  % are used here to define the new options.
  % \@ifnextchar and \@namedef are provided by miniltx.tex.
  \def\GPT@define@key#1#2{%
    \@ifnextchar[{%
      \GPT@KV@def{#1}{#2}%
    }{%
      \@namedef{KV@#1@#2}####1%
    }%
  }%
  \def\GPT@KV@def#1#2[#3]{%
    \@namedef{KV@#1@#2@default\expandafter}\expandafter
        {\csname KV@#1@#2\endcsname{#3}}%
    \@namedef{KV@#1@#2}##1%
  }%
\else
  \let\GPT@define@key\define@key
\fi
\GPT@define@key{Gin}{page}{%
  \def\GPT@page{#1}%
}%
\GPT@define@key{Gin}{print}{%
  \def\GPT@print{#1}%
}%
\GPT@define@key{Gin}{quiet}[]{%
  \let\Gin@log\@gobble
}%
\GPT@define@key{Gin}{resolution}{%
  \pdfimageresolution#1\relax
}%
\GPT@define@key{Gin}{attr}{%
  \def\GPT@attr{attr {#1}}%
}%
\GPT@define@key{Gin}{pagebox}{%
  \def\GPT@pagebox{ #1}%
}%
%</package>
%    \end{macrocode}
%    \begin{macrocode}
%<*package,package003>
% redefinitions of some graphicx options:
\def\GPT@disable#1{%
  \GPT@warn{%
    Option `#1' is not supported, use\MessageBreak
    option `viewport' instead%
  }%
}
%    \end{macrocode}
% \begin{oldcomments}
% Here we have to trust that package graphicx is not
% loaded after applying the fix "\AtBeginDocument".
% \end{oldcomments}
%    \begin{macrocode}
\def\GPT@fix{%
  \begingroup\expandafter\expandafter\expandafter\endgroup
  \expandafter\ifx\csname define@key\endcsname\relax
  \else
    \def\KV@Gin@bb{%
      \GPT@warn{%
        Option `bb' does not make sense,\MessageBreak
        using `viewport' instead%
      }%
      \KV@Gin@viewport
    }%
    \define@key{Gin}{bbllx}{\GPT@disable{bbllx}}%
    \define@key{Gin}{bblly}{\GPT@disable{bblly}}%
    \define@key{Gin}{bburx}{\GPT@disable{bburx}}%
    \define@key{Gin}{bbury}{\GPT@disable{bbury}}%
  \fi
}
\AtBeginDocument{\GPT@fix}
%</package,package003>
%    \end{macrocode}
% \begin{oldcomments}
% mechanism for re-use of objects also allows us to 
% get the size by deriving it from the initial storage; 
% this works for all graphics types.
% \end{oldcomments}
%    \begin{macrocode}
%<package003>\newcount\Gread@gobject
%<*package,package003>
\def\GPT@ReusedName#1{%
  \ifx\GPT@print\@empty
    #1%
  \else
    \GPT@print
  \fi
}
\def\Gread@pdftex#1{%
  % Ensure that option `print' works only on bitmap images.
  \ifGPT@IsBitmap
  \else
    \ifx\GPT@print\@empty
    \else
      \GPT@warn{%
        Option `print' can only be used\MessageBreak
        for bitmap images%
      }%
      \let\GPT@print\@empty
    \fi
  \fi
  % If option `print' is set, the screen image object
  % will contain an additional /Alternate entry
  % and will therefore not be reused.
  \ifx\GPT@print\@empty
  \else
    \expandafter\expandafter\expandafter\@firstoftwo\expandafter\@gobbletwo
  \fi
%</package,package003>
%    \end{macrocode}
%    \begin{macrocode}
%<*package003>
  \@ifundefined{#1 image\GPT@page}{%
    \ifnum\driver@release>4
      \ifnum\driver@release>5
        \ifx\GPT@print\@empty
          \let\GPT@RuleAttr\@empty
        \else
          \@ifundefined{\GPT@print\space image\GPT@page}{%
            \immediate\pdfximage{\GPT@print}%
            \setbox\@tempboxa=\hbox{\pdfrefximage\pdflastximage}%
            \edef\GPT@PrintObj{\the\pdflastximage}%
            \expandafter\xdef\csname\GPT@print\space
              image\GPT@page\endcsname{\pdfrefximage\GPT@PrintObj}%
            \immediate\pdfobj{%
              [<<%
                /Image \GPT@PrintObj\space 0 R%
                /DefaultForPrinting true%
              >>]%
            }%
            \def\GPT@RuleAttr{%
              width\wd\@tempboxa height\ht\@tempboxa
              attr{/Alternates \the\pdflastobj\space 0 R}%
            }%
          }{%
            \edef\GPT@PrintObj{%
              \expandafter\expandafter\expandafter\@gobble
              \csname\GPT@print\space image\GPT@page\endcsname
            }%
            \immediate\pdfobj{%
              [<<%
                /Image \GPT@PrintObj \space 0 R%
                /DefaultForPrinting true%
              >>]%
            }%
            \def\GPT@RuleAttr{%
              width \csname\GPT@print\space width\GPT@page\endcsname
              height \csname\GPT@print\space height\GPT@page\endcsname
              attr{/Alternates \the\pdflastobj\space 0 R}%
            }%
          }%
        \fi
        \pdfximage \GPT@RuleAttr
        \ifx\GPT@page\@empty
        \else
          page \GPT@page
        \fi
        {#1}%
        \setbox\@tempboxa=\hbox{\pdfrefximage\pdflastximage}%
      \else
        \setbox\@tempboxa=\hbox{\pdfimage{#1}}%
      \fi
    \else
      \setbox\@tempboxa=\hbox{%
        \pdfimage\noexpand\noexpand\noexpand\@empty#1\relax
      }%
    \fi
    \def\Gin@llx{0}\let\Gin@lly\Gin@llx
    \Gin@defaultbp\Gin@urx{\wd\@tempboxa}%
    \Gin@defaultbp\Gin@ury{\ht\@tempboxa}%
    \expandafter\xdef\csname\GPT@ReusedName{#1} width\GPT@page\endcsname{%
      \the\wd\@tempboxa
    }%
    \expandafter\xdef\csname\GPT@ReusedName{#1} height\GPT@page\endcsname{%
      \the\ht\@tempboxa
    }%
    \ifnum\driver@release>5
      \expandafter\xdef\csname #1 image\GPT@page
        \ifx\GPT@print\@empty\else!\fi\endcsname{%
        \pdfrefximage\the\pdflastximage
      }%
    \else
      \pdfform\@tempboxa
      \Gread@gobject=\pdflastform
      \expandafter\xdef\csname#1 image\endcsname{%
        \pdfrefform\the\Gread@gobject
      }%
    \fi
    \Gin@log{%
       <#1, id=%
       \ifnum\driver@release>5
         \the\pdflastximage
         \ifx\GPT@page\@empty\else , page=\GPT@page\fi
         \ifx\GPT@print\@empty
         \else
            , print=\GPT@print, id=\GPT@PrintObj
         \fi
       \else
         \the\Gread@gobject
       \fi
%</package003>
%    \end{macrocode}
%    \begin{macrocode}
%<*package>
  % Ensure the default cropbox for \GPT@pagebox
  \ifx\GPT@pagebox\empty
    \def\GPT@pagebox{ cropbox}%
  \fi
  \@ifundefined{#1 image\GPT@page\GPT@pagebox}{%
    \ifx\GPT@print\@empty
      \let\GPT@RuleAttr\@empty
    \else
      \@ifundefined{\GPT@print\space image\GPT@page}{%
        \immediate\pdfximage{\GPT@print}%
        \setbox\@tempboxa=\hbox{\pdfrefximage\pdflastximage}%
        \edef\GPT@PrintObj{\the\pdflastximage}%
        \expandafter\xdef\csname\GPT@print\space
          image\GPT@page\GPT@pagebox\endcsname{\pdfrefximage\GPT@PrintObj}%
        \immediate\pdfobj{%
          [<<%
            /Image \GPT@PrintObj\space 0 R%
            /DefaultForPrinting true%
          >>]%
        }%
        \def\GPT@RuleAttr{%
          width\wd\@tempboxa height\ht\@tempboxa
        }%
        \g@addto@macro\GPT@attr{/Alternates \the\pdflastobj\space 0 R}%
      }{%
        \edef\GPT@PrintObj{%
          \expandafter\expandafter\expandafter\@gobble
          \csname\GPT@print\space image\GPT@page\GPT@pagebox\endcsname
        }%
        \immediate\pdfobj{%
          [<<%
            /Image \GPT@PrintObj \space 0 R%
            /DefaultForPrinting true%
          >>]%
        }%
        \def\GPT@RuleAttr{%
          width \csname\GPT@print\space width\GPT@page\GPT@pagebox\endcsname
          height \csname\GPT@print\space height\GPT@page\GPT@pagebox\endcsname
        }%
        \g@addto@macro\GPT@attr{/Alternates \the\pdflastobj\space 0 R}%
      }%
    \fi
    \pdfximage \GPT@RuleAttr \GPT@attr
    \ifx\GPT@page\@empty
    \else
      page \GPT@page
    \fi
    \GPT@pagebox
    {#1}%
    \setbox\@tempboxa=\hbox{\pdfrefximage\pdflastximage}%
    \def\Gin@llx{0}\let\Gin@lly\Gin@llx
    \Gin@defaultbp\Gin@urx{\wd\@tempboxa}%
    \Gin@defaultbp\Gin@ury{\ht\@tempboxa}%
    \expandafter\xdef\csname\GPT@ReusedName{#1} width\GPT@page\GPT@pagebox\endcsname{%
      \the\wd\@tempboxa
    }%
    \expandafter\xdef\csname\GPT@ReusedName{#1} height\GPT@page\GPT@pagebox\endcsname{%
      \the\ht\@tempboxa
    }%
    \expandafter\xdef\csname #1 image\GPT@page\GPT@pagebox
      \ifx\GPT@print\@empty\else!\fi\endcsname{%
      \pdfrefximage\the\pdflastximage
    }%
    \Gin@log{%
       <#1, id=%
       \the\pdflastximage
       \ifx\GPT@page\@empty\else , page=\GPT@page\fi
       , pagebox=\GPT@pagebox
       \ifx\GPT@print\@empty
       \else
          , print=\GPT@print, id=\GPT@PrintObj
       \fi
%</package>
%<*package,package003>
       , \the\wd\@tempboxa\space x \the\ht\@tempboxa
       >%
     }%
  }{%
    \def\Gin@llx{0}\let\Gin@lly\Gin@llx
%</package,package003>
%<*package003>
    \Gin@defaultbp\Gin@urx{\csname#1 width\GPT@page\endcsname}%
    \Gin@defaultbp\Gin@ury{\csname#1 height\GPT@page\endcsname}%
%</package003>
%<*package>
    \Gin@defaultbp\Gin@urx{\csname#1 width\GPT@page\GPT@pagebox\endcsname}%
    \Gin@defaultbp\Gin@ury{\csname#1 height\GPT@page\GPT@pagebox\endcsname}%
%</package>
%<*package,package003>
  }%
}
%</package,package003>
%    \end{macrocode}
%    \begin{macrocode}
%<*package,package003>
\def\Ginclude@pdftex#1{%
  \def\@tempa{!}%
  \ifx\Gin@scaley\@tempa
    \let\Gin@scaley\Gin@scalex
  \else
    \ifx\Gin@scalex\@tempa\let\Gin@scalex\Gin@scaley\fi
  \fi
  \Gin@log{%
    <use #1%
    \ifx\GPT@page\@empty\else, page \GPT@page\fi
    >%
  }%
  \hbox{%
    \Gscale@box{\Gin@scalex}[\Gin@scaley]{%
      \@ifundefined{Gin@vllx}{%
        \GPT@viewportfalse
        % without viewport/trim clipping does not make sense
        % for pdfTeX
        \Gin@clipfalse
      }{}%
      \ifGin@clip
%</package,package003>
%<*package003>
        \ifnum\driver@release<6
          \GPT@warn{No clipping support in pdfTeX < 0.14}%
        \else
%</package003>
%<*package,package003>
          \if!\Gin@vllx\Gin@vlly\Gin@vurx\Gin@vury!%
          \else
            \let\GPT@clipend\GPT@DoClipEnd
            \setbox\@tempboxa\hbox\bgroup
          \fi
%</package,package003>
%<package003>        \fi
%<*package,package003>
      \fi
      \ifGPT@viewport
        \ifdim\Gin@vlly\p@=\z@
        \else
          \lower\Gin@vlly bp\hbox\bgroup
        \fi
        \ifdim\Gin@vllx\p@=\z@
        \else
          \hskip-\Gin@vllx bp\relax
        \fi
      \fi
%</package,package003>
%<package003>\csname#1 image\GPT@page
%<package>\csname#1 image\GPT@page\GPT@pagebox
%<*package,package003>
        \ifx\GPT@print\@empty\else!\fi
      \endcsname
      \ifGPT@viewport
        \ifdim\Gin@vlly\p@=\z@
        \else
          \egroup
        \fi
        \GPT@clipend
      \fi
    }%
  }%
}
%    \end{macrocode}
%    \begin{macrocode}
\newif\ifGPT@viewport
\GPT@viewporttrue
\let\GPT@clipend\relax
\def\GPT@DoClipEnd{%
  \egroup
  \dp\@tempboxa\z@
  % \Gin@urx and \Gin@ury already contain the correct values,
  % so both cases viewport and trim can be handled together:
  \dimen@\Gin@urx\p@
  % v0.03k \Gin@vllx replaced by \Gin@llx
  \advance\dimen@ -\Gin@llx\p@
  \wd\@tempboxa\strip@pt\dimen@ bp\relax
  \dimen@\Gin@ury\p@
  % v0.03k \Gin@vlly replaced by \Gin@lly
  \advance\dimen@ -\Gin@lly\p@
  \ht\@tempboxa\strip@pt\dimen@ bp\relax
  \pdfxform\@tempboxa
  \pdfrefxform\pdflastxform
}
\newif\ifGPT@IsBitmap
\def\Gread@pdfbitmap#1{%
  \GPT@IsBitmaptrue
  \Gread@pdftex{#1}%
  \GPT@IsBitmapfalse
}
%    \end{macrocode}
%    \begin{macrocode}
\edef\Gread@MBox{/MediaBox}
\def\Gread@pdf#1{%
  \begingroup
    \@tempcnta\z@
    \loop
    \ifnum\@tempcnta<\@xxxii
      \catcode\@tempcnta14 %
      \advance\@tempcnta\@ne
    \repeat
    \catcode127=14 %
    \let\do\@makeother\dospecials\catcode`\ 10 %
    \catcode\endlinechar5 %
    \immediate\openin\@inputcheck#1 %
    \ifeof\@inputcheck
      \@latex@error{File `#1' not found}\@ehc
    \else
      \Gread@true
      \let\@tempb\Gread@false
      \loop
% v0.02e: use \. not \@tempa so the space is preserved before [
        \read\@inputcheck to\.%
        \ifeof\@inputcheck
          \Gread@false
        \else
          \expandafter\Gread@find@mbox\. []\\%
        \fi
      \ifGread@
      \repeat
      \immediate\closein\@inputcheck
    \fi
    \ifGin@bbox
    \else
      \@latex@error
      {Cannot determine size of graphic in #1 (no BoundingBox)}%
      \@ehc
      \gdef\@gtempa{0 0 72 72 }%
    \fi
  \endgroup
  \expandafter\Gread@parse@bb\@gtempa\\%
}
\long\def\Gread@find@mbox#1 [#2]#3\\{%
  \def\@tempa{#1}%
  \ifx\@tempa\Gread@MBox
    \gdef\@gtempa{#2 }%
    \@tempb
    \Gin@bboxtrue
  \fi
}
\def\Ginclude@png#1{%
  \hbox{%
% v0.02f add \@depth\z@ (from Sebastian)
    \pdfimage
      \@height\Gin@req@height \@width\Gin@req@width \@depth\z@
      \noexpand\noexpand\noexpand\@empty#1\relax
  }%
}
%    \end{macrocode}
%    \begin{macrocode}
\def\Ginclude@mps#1{%
  \def\@tempa{!}%
  \ifx\Gin@scaley\@tempa
    \let\Gin@scaley\Gin@scalex
  \else
    \ifx\Gin@scalex\@tempa\let\Gin@scalex\Gin@scaley\fi
  \fi
  \hbox{%
    \Gscale@box{\Gin@scalex}[\Gin@scaley]{%
      \@ifundefined{Gin@vllx}{%
        \GPT@viewportfalse
        % without viewport/trim clipping does not make sense
        % for pdfTeX
        \Gin@clipfalse
      }{}%
      \ifGin@clip
%</package,package003>
%<*package003>
        \ifnum\driver@release<6
          \GPT@warn{No clipping support in pdfTeX < 0.14}%
        \else
%</package003>
%<*package,package003>
          \if!\Gin@vllx\Gin@vlly\Gin@vurx\Gin@vury!%
          \else
            \let\GPT@clipend\GPT@DoClipEnd
            \setbox\@tempboxa\hbox\bgroup
          \fi
%</package,package003>
%<package003>        \fi
%<*package,package003>
      \fi
      \ifGPT@viewport
        \ifdim\Gin@vlly\p@=\z@
        \else
          \lower\Gin@vlly bp\hbox\bgroup
        \fi
        \ifdim\Gin@vllx\p@=\z@
        \else
          \hskip-\Gin@vllx bp\relax
        \fi
      \fi
      \convertMPtoPDF{#1}{1}{1}%
      \ifGPT@viewport
        \ifdim\Gin@vlly\p@=\z@
        \else
          \egroup
        \fi
        \GPT@clipend
      \fi
    }%
  }%
}
\def\Gread@mps{\Gread@eps}
%</package,package003>
%<*package003>
\ifnum\driver@release>5
  \let\Gread@tif\Gread@pdfbitmap
  \let\Ginclude@tif\Ginclude@pdftex
\fi
\ifnum\driver@release>3
  \let\Ginclude@png\Ginclude@pdftex
  \let\Ginclude@jpg\Ginclude@pdftex
  \let\Ginclude@pdf\Ginclude@pdftex
  \let\Gread@pdf\Gread@pdftex
  \let\Gread@png\Gread@pdfbitmap
  \let\Gread@jpg\Gread@pdfbitmap
\else
  \def\Ginclude@pdf#1{%
    \def\@tempa{!}%
    \ifx\Gin@scaley\@tempa
      \let\Gin@scaley\Gin@scalex
    \else
      \ifx\Gin@scalex\@tempa\let\Gin@scalex\Gin@scaley\fi
    \fi
    \hbox{%
      \convertPDFtoPDF{#1}{\Gin@scalex}{\Gin@scaley} {0bp} {0bp}%
      {\Gin@req@width}{\Gin@req@height}%
    }%
  }
\fi
%    \end{macrocode}
% \begin{oldcomments}
% v0.02e: restrict the rules to just the types that pdftex can currently
% deal with.
% \end{oldcomments}
%    \begin{macrocode}
\ifnum\driver@release>3
  \ifnum\driver@release>5
    \def\Gin@extensions{.png,.pdf,.jpg,.mps,.tif}
    \@namedef{Gin@rule@.tif}#1{{tif}{.tif}{#1}}
    \@namedef{Gin@rule@.jpg}#1{{jpg}{.jpg}{#1}}
  \else
    \def\Gin@extensions{.png,.pdf,.jpg,.mps}
    \@namedef{Gin@rule@.jpg}#1{{jpg}{.jpg}{#1}}
  \fi
\else
  \def\Gin@extensions{.png,.pdf,.mps}
\fi
%</package003>
%<*package>
\let\Ginclude@png\Ginclude@pdftex
\let\Ginclude@jpg\Ginclude@pdftex
\let\Ginclude@pdf\Ginclude@pdftex
\let\Gread@pdf\Gread@pdftex
\let\Gread@png\Gread@pdfbitmap
\let\Gread@jpg\Gread@pdfbitmap
%    \end{macrocode}
%    \begin{macrocode}
\def\Gin@extensions{.png,.pdf,.jpg,.mps}
\@namedef{Gin@rule@.jpg}#1{{jpg}{.jpg}{#1}}
%</package>
%<*package,package003>
\@namedef{Gin@rule@.png}#1{{png}{.png}{#1}}
\@namedef{Gin@rule@.mps}#1{{mps}{.mps}{#1}}
\@namedef{Gin@rule@.pdf}#1{{pdf}{.pdf}{#1}}
%    \end{macrocode}
% \begin{oldcomments}
% Rotation
% slightly hacky, but set width of box 0 to 0pt otherwise
% the CTM gets restored in the wrong place.
% Patrick Daly found an error here with doubled minus signs when \Grot@sin is
% negative. Fixed.
% \end{oldcomments}
%    \begin{macrocode}
\def\Grot@start{%
  \pdfliteral{ q
     \Grot@cos\space\Grot@sin\space\if-\Grot@sin\else-\Grot@sin\fi\space\Grot@cos\space
     0 0 cm%
  }%
  \wd\z@\z@
}
\def\Grot@end{\pdfliteral{ Q}}
%    \end{macrocode}
% \begin{oldcomments}
% Scaling is OK, as graphics package does it right here.
% \end{oldcomments}
%    \begin{macrocode}
\def\Gscale@start{%
  \pdfliteral{ q
    \Gscale@x\space0 0 \Gscale@y\space 0 0 cm%
  }%
}
\let\Gscale@end\Grot@end
%    \end{macrocode}
% \begin{oldcomments}
% undo the trig.sty `optimisation' so that these 0 1 and -1 values
% get written out as digits, not unexpandable TeX primitives.
% \end{oldcomments}
%    \begin{macrocode}
\AtBeginDocument{%
  \expandafter\def\csname sin(0)\endcsname{0}%
  \expandafter\def\csname cos(0)\endcsname{1}%
  \expandafter\def\csname sin(90)\endcsname{1}%
  \expandafter\def\csname cos(90)\endcsname{0}%
  \expandafter\def\csname sin(-90)\endcsname{-1}%
  \expandafter\def\csname cos(-90)\endcsname{0}%
  \expandafter\def\csname sin(180)\endcsname{0}%
  \expandafter\def\csname cos(180)\endcsname{-1}%
}
%</package,package003>
%<*package>
%    \end{macrocode}
% \begin{oldcomments}
% Patch \Gin@setfile to execute #3, if it contains
% a command
% \end{oldcomments}
%    \begin{macrocode}
\AtBeginDocument{%
  \let\GPT@orgGin@setfile\Gin@setfile
  \def\Gin@setfile#1#2#3{%
    \if`\@car #3\relax\@nil
      \immediate\write18{\@cdr #3\@empty\@nil}%
      \GPT@orgGin@setfile{#1}{#2}{\Gin@base #2}%
    \else
      \GPT@orgGin@setfile{#1}{#2}{#3}%
    \fi
  }%
}
%</package>
%<*package,package003>
%    \end{macrocode}
% \begin{oldcomments}
% Are we running under PDFTeX?
% \end{oldcomments}
%    \begin{macrocode}
\ifx\pdfpageheight\@undefined
  \PackageWarningNoLine{%
    \@ifundefined{@currname}{pdftex.def}{\@currname}%
  }{%
    pdftex option does not work with standard TeX%
  }%
\else
  \ifx\paperwidth\@undefined
  \else
    \ifdim\paperheight=0pt\relax
    \else
      \pdfpageheight\paperheight
    \fi
    \ifdim\paperwidth=0pt\relax
    \else
      \pdfpagewidth\paperwidth
    \fi
  \fi
  \pdfoutput=1
\fi
%    \end{macrocode}
% \begin{oldcomments}
% v0.02e: Restore catcodes of context letters.
% Not needed with current version of supp-pdf
% but protects against older versions.
% \end{oldcomments}
%    \begin{macrocode}
\AtBeginDocument{%
  \edef\@tempa{%
    \catcode`\noexpand\!\the\catcode`\!
    \catcode`\noexpand\@\the\catcode`\@
    \catcode`\noexpand\?\the\catcode`\? }%
  \InputIfFileExists{supp-pdf}{}{}%
  \@tempa
}
%    \end{macrocode}
% \begin{oldcomments}
% these seem to upset pdftex. ignore them. SPQR 1999/08/02
% allow for plain graphics, not graphicx.
% pdftex.def is loaded before the definition in graphicx,
% so do all the stuff \AtBeginDocument:
% \end{oldcomments}
%    \begin{macrocode}
\AtBeginDocument{%
  \@ifundefined{define@key}{}{%
    \define@key{Gin}{natwidth}{}%
    \define@key{Gin}{natheight}{}%
  }%
}%
%</package,package003>
%    \end{macrocode}
%
% ^^A -----------------------------
%
%  \section{Old history}
%  ^^A
% \begin{footnotesize}
% \begin{oldcomments}
% 2003/06/20 v0.10a
%  * Added option 'attr' (MS).
%  * Added option 'pagebox' (MS).
%  * Allow \write18 (MS).
%  * Remove support for tif images as per pdftex 1.01a (MS).
%  * Moved code for older versions to pdftex03.def
%  * Fix for bug #516: definitions of keyval's \define@key
%    used for new options to get more independence of package
%    loading order (HO).
%  * Added support for color models "hsb" and "HSB" (HO).
% 2002/06/19 v0.03k
%  * Correction by P\'etiard Fran\c{c}ois for \GPT@DoEndClip.
% 2002/06/18 v0.03j
%  * Contribution by P\'etiard Fran\c{c}ois <petiard@math.univ-fcomte.fr>:
%    Improvement of \Ginclude@mps (support of viewport and clip).
% 2001/11/29 v0.03i
%  * Problem with \if@inlabel (plain format) fixed.
% 2001/09/01 v0.03h
%  * Compatibilty for miniltx.tex, problems fixed:
%    \@ifpackageloaded, \PackageWarning, \PackageWarningNoLine,
%    \@currname.
% 2001/05/25 v0.03g
%  * \pdfpagewidth and \pdfpageheight are not set to zero,
%    if \paperwidth and \paperheight are not set (HO).
% 2000/11/10 v0.03f
%  * Bug, that produces an error message, if package `graphics'
%    is used (introduced in 0.03d), fixed: If \Gin@vllx is not
%    defined (graphics), then clipping and the moves of options
%    viewport/trim are silently disabled (HO).
% 2000/09/14 v0.03e
%  * Options `bbllx', `bblly', `bburx', `bbury' disabled,
%    option `bb' redirected with a warning to `viewport' (HO).
% 2000/09/14 v0.03d
%  * Fixes for `viewport' and `trim' (HO).
%  * Clip support added for viewport and trim (HO).
% 2000/09/04 v0.03c
%  * Redefinition of `natwidth' and `natheight' \AtBeginDocument (HO).
% 2000/08/31 v0.03b:
%  * support for alternate print images: option `print' added (HO).
%    * This feature is not supported by Ghostscript, xpdf, or AR3.
%    * The images should have the same dimensions/resolution.
%  * Two experimental options added (HO):
%    * `quiet': log messages are suppressed.
%    * `resolution': sets \pdfimageresolution.
%    Because these options are not supported by graphicx,
%    they have to be set after \usepackage{graphicx}, eg.
%      \setkeys{Gin}{quiet,resolution=300}
%    Option `quiet' (for pdftex) can be make known to graphic{s,x}
%    with this line in graphics.cfg:
%      \DeclareOption{quiet}{\let\Gin@log\@gobble}
%    Caution: both options are experimental and can be
%    change in next versions!
%  * \pdfpage{width,height} are only set, if \paperwidth
%    is defined (HO).
% 2000/06/16 v0.03a:
%  * Added Heiko to author list (DPC).
% 2000/05/31 v0.02v:
%  * Option `page' is defined at begin document,
%    if package `keyval' is loaded after `pdftex.def'.
% 2000/05/12 v0.02u:
%  * support for multipage pdf files, option `page' added (HO).
% 2000/05/02 v0.02t:
%  * \pagecolor supported (HO).
% 2000/04/20 v0.02s:
%  * gray color model directly supported (HO).
% ...
% \end{oldcomments}
% \end{footnotesize}
%
%
% ^^A -----------------------------
%
%  \Finale
% ^^A vim:tw=70:ts=2:syntax=tex
